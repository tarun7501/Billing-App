<div *ngIf="isLoading" class="flex items-center justify-center h-[60vh]">
    <p class="text-slate-500 text-lg">Loading bill...</p>
</div>

<div class="p-8" *ngIf="!isLoading && bill; else notFound">
    <div class="flex items-center justify-between mb-8 no-print">
        <div class="flex items-center gap-4">
            <button (click)="goBack()" class="p-2 rounded hover:bg-slate-100">‚Üê</button>
            <div>
                <h1 class="text-3xl font-semibold text-slate-800">Bill Details</h1>
                <p class="text-slate-500 mt-1">{{ bill.billNumber }}</p>
            </div>
        </div>

        <div class="flex gap-3">
            <button class="px-4 py-2 border rounded" (click)="downloadPDF()">‚¨á Download PDF</button>
            <button class="px-4 py-2 border rounded" (click)="shareWhatsApp()">üì§ Share</button>
            <button
                *ngIf="bill.status === 'Pending'"
                class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50"
                [disabled]="isClearing"
                (click)="markAsCleared()"
            >
                {{ isClearing ? 'Processing...' : '‚úî Mark as Cleared' }}
            </button>
        </div>
    </div>

    <div id="bill-pdf" class="pdf-export bg-white border rounded-xl shadow-sm max-w-5xl mx-auto p-10 space-y-10">
        <div class="flex justify-between items-start border-b border-slate-200 pb-6">
            <div style="max-width: 65%">
                <div class="brand-title">Rajan Photo Studio</div>

                <div class="brand-subtitle">Capturing Moments, Creating Memories üì∏</div>
            </div>

            <div class="text-right text-sm space-y-2">
                <div>
                    <span class="font-semibold text-slate-600">Bill No:</span>
                    <span class="ml-1">{{ bill.billNumber }}</span>
                </div>

                <div>
                    <span class="font-semibold text-slate-600">Bill Date:</span>
                    <span class="ml-1">{{ bill.date | date:'dd MMM yyyy' }}</span>
                </div>

                <div
                    class="inline-block mt-2 px-4 py-1 rounded-full text-xs font-bold"
                    [ngClass]="{
        'status-cleared': bill.status === 'Cleared',
        'status-pending': bill.status === 'Pending'
    }"
                >
                    {{ bill.status }}
                </div>
            </div>
        </div>

        <div class="grid grid-cols-3 gap-6">
            <div class="border rounded-lg p-5">
                <div class="text-xs uppercase tracking-wide text-slate-500 mb-1">Customer Name</div>
                <div class="text-lg font-semibold">{{ bill.customerName }}</div>
            </div>

            <div class="border rounded-lg p-5">
                <div class="text-xs uppercase tracking-wide text-slate-500 mb-1">Phone Number</div>
                <div class="text-lg font-semibold">{{ bill.phone }}</div>
            </div>

            <div class="border rounded-lg p-5">
                <div class="text-xs uppercase tracking-wide text-slate-500 mb-1">Email Address</div>
                <div class="text-lg font-semibold">{{ bill.email || '‚Äî' }}</div>
            </div>
        </div>

        <div class="space-y-8">
            <div class="text-xl font-bold text-slate-700 border-b pb-2">Bill Items</div>
            <div *ngIf="bill.mobilePhotoItems.length">
                <div class="text-lg font-semibold mb-3">üì± Mobile Photo Prints</div>
                <table class="modern-table">
                    <thead>
                        <tr>
                            <th>Photo Size</th>
                            <th>Copies</th>
                            <th>Unit Price</th>
                            <th class="text-right">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let i of bill.mobilePhotoItems">
                            <td>{{ i.photoSize }}</td>
                            <td>{{ i.numberOfCopies }}</td>
                            <td>‚Çπ{{ i.unitPrice }}</td>
                            <td class="text-right font-semibold">‚Çπ{{ i.total }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div *ngIf="bill.studioPhotoItems.length">
                <div class="text-lg font-semibold mb-3">üéûÔ∏è Studio Photo Prints</div>

                <table class="modern-table">
                    <thead>
                        <tr>
                            <th>Photo Size</th>
                            <th>Copies</th>
                            <th>Unit Price</th>
                            <th class="text-right">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let i of bill.studioPhotoItems">
                            <td>{{ i.photoSize }}</td>
                            <td>{{ i.numberOfCopies }}</td>
                            <td>‚Çπ{{ i.unitPrice }}</td>
                            <td class="text-right font-semibold">‚Çπ{{ i.total }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div *ngIf="bill.laminationItems.length">
                <div class="text-lg font-semibold mb-3">üßæ Photo with Lamination</div>

                <table class="modern-table">
                    <thead>
                        <tr>
                            <th>Size</th>
                            <th>Copies</th>
                            <th>Type</th>
                            <th>Finish</th>
                            <th>Unit Price</th>
                            <th class="text-right">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let i of bill.laminationItems">
                            <td>{{ i.photoSize }}</td>
                            <td>{{ i.numberOfCopies }}</td>
                            <td>{{ i.laminationType }}</td>
                            <td>{{ i.laminationFinish }}</td>
                            <td>‚Çπ{{ i.unitPrice }}</td>
                            <td class="text-right font-semibold">‚Çπ{{ i.total }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="bg-indigo-50 rounded-lg p-6 space-y-3">
            <div class="flex justify-between">
                <span>Subtotal</span>
                <span>‚Çπ{{ bill.subtotal }}</span>
            </div>

            <div class="flex justify-between text-red-500">
                <span>Discount</span>
                <span>- ‚Çπ{{ bill.discount }}</span>
            </div>

            <div class="flex justify-between text-lg font-bold text-indigo-700 border-t pt-2">
                <span>Total</span>
                <span>‚Çπ{{ bill.totalAmount }}</span>
            </div>

            <div class="flex justify-between text-green-600 font-semibold">
                <span>Advance</span>
                <span>‚Çπ{{ bill.advanceAmount }}</span>
            </div>

            <div
                class="flex justify-between text-xl font-bold"
                [ngClass]="bill.balanceAmount > 0 ? 'text-amber-600' : 'text-green-700'"
            >
                <span>Balance</span>
                <span>‚Çπ{{ bill.balanceAmount }}</span>
            </div>
        </div>

        <div class="border-t pt-6 text-center space-y-3">
            <div class="text-lg font-semibold text-slate-700">Thank you for choosing Rajan Photo Studio ‚ù§Ô∏è</div>

            <div class="text-sm text-slate-500">
                Your memories are precious to us. We truly appreciate your trust and look forward to serving you again!
            </div>

            <div class="text-sm text-slate-600 mt-4">üìû For any queries, feel free to contact us:</div>
            <div class="text-base font-medium text-slate-700">
                <a href="tel:8144438779" class="hover:underline">8144438779</a> |
                <a href="tel:9937494477" class="hover:underline">9437524859</a>
            </div>
        </div>
    </div>
</div>

<ng-template #notFound>
    <div *ngIf="!isLoading" class="p-8 text-center">
        <p class="text-slate-500">Bill not found.</p>
        <button class="mt-4 px-4 py-2 border rounded" (click)="goBack()">Go Back</button>
    </div>
</ng-template>
